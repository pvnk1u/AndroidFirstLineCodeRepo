# 更强大的滚动控件：RecycleView

ListView由于强大的功能，在过去的Android开发当中可以说是贡献卓越，直到今天仍然还有不计其数的程序在使用ListView。不过ListView并不是完美无缺的，比如如果不使用一些技巧来提升它的运行效率，那么ListView的性能就会非常差。还有，ListView的扩展性也不够好，它只能实现数据纵向滚动的效果，如果想实现横向滚动的话，ListView是做不到的。



为此，Android提供了一个更强大的滚动控件——RecyclerView。它可以说是一个增强版的ListView，不仅可以轻松实现和ListView同样的效果，还优化了ListView存在的各种不足之处。目前Android官方更加推荐使用RecyclerView，未来也会有更多的程序逐渐从ListView转向RecyclerView。



## RecycleView的基本用法

**和之前所学的所有控件不同，RecyclerView属于新增控件，那么怎样才能让新增的控件在所有Android系统版本上都能使用呢？为此，Google将RecyclerView控件定义在了AndroidX当中，只需要在项目的build.gradle中添加RecyclerView库的依赖，就能保证在所有Android系统版本上都可以使用RecyclerView控件了。**



修改activity_main.xml中的代码，如下所示：

```xml
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <!--
    在布局中加入RecyclerView控件，先为RecyclerView指定一个id，
    然后将宽度和高度都设置为match_parent，这样RecyclerView就占满了整个布局的空间。
    -->
    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/recyclerView"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />

</LinearLayout>
```

在布局中加入RecyclerView控件也是非常简单的，先为RecyclerView指定一个id，然后将宽度和高度都设置为match_parent，这样RecyclerView就占满了整个布局的空间。



相应的Fruit类和fruit_item.xml：

```kotlin
class Fruit(val name:String,val imageId: Int)
```

```xml
<!--
在这个布局中，定义了一个ImageView用于显示水果的图片，又定义了一个TextView用于
显示水果的名称，并让ImageView和TextView都在垂直方向上居中显示。
-->
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="60dp">
    <ImageView
        android:id="@+id/fruitImage"
        android:layout_width="40dp"
        android:layout_height="40dp"
        android:layout_gravity="center_vertical"
        android:layout_marginLeft="10dp"/>
    <TextView
        android:id="@+id/fruitName"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_vertical"
        android:layout_marginLeft="10dp" />
</LinearLayout>
```

接下来需要为RecyclerView准备一个适配器，新建FruitAdapter类，让这个适配器继承自RecyclerView.Adapter，并将泛型指定为FruitAdapter.ViewHolder。其中，ViewHolder是在FruitAdapter中定义的一个内部类，代码如下所示：

```kotlin
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.ImageView
import android.widget.TextView
import androidx.recyclerview.widget.RecyclerView

/**
 * RecyclerView适配器
 */
/**
 * 由于FruitAdapter是继承自RecyclerView.Adapter的，那么就必须重写
 * onCreateViewHolder()、onBindViewHolder()和getItemCount()这3个方法。
 *
 * 1、onCreateViewHolder()方法是用于创建ViewHolder实例的，在这个方法中将
 * fruit_item布局加载进来，然后创建一个ViewHolder实例，并把加载出来的布局传入构造
 * 函数当中，最后将ViewHolder的实例返回。
 * 2、onBindViewHolder()方法用于对RecyclerView子项的数据进行赋值，会在每个子项被滚动到屏幕内的时候执行，
 * 这里通过position参数得到当前项的Fruit实例，然后再将数据设置到ViewHolder的ImageView和
 * TextView当中即可。
 * 3、getItemCount()方法就非常简单了，它用于告诉RecyclerView一共有
 * 多少子项，直接返回数据源的长度就可以了。
 */
class FruitAdapter(val fruitList : List<Fruit>) :
                RecyclerView.Adapter<FruitAdapter.ViewHolder>(){

    /**
     * 定义一个内部类ViewHolder,继承自RecyclerView.ViewHolder。
     * 然后ViewHolder的主构造函数中要传入一个View参数，
     * 这个参数通常就是RecyclerView子项的最外层布局，那么就可以通过findViewById()方
     * 法来获取布局中ImageView和TextView的实例了。
     */
    inner class ViewHolder(view:View) : RecyclerView.ViewHolder(view){
        val fruitImage: ImageView = view.findViewById(R.id.fruitImage)
        val fruitName: TextView = view.findViewById(R.id.fruitName)
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.fruit_item,parent,false)
        return ViewHolder(view)
    }

    override fun getItemCount() = fruitList.size

    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        val fruit = fruitList[position]
        holder.fruitImage.setImageResource(fruit.imageId)
        holder.fruitName.text = fruit.name
    }
}
```



适配器准备好了之后，就可以开始使用RecyclerView了，修改MainActivity中的代码，如下所示：

```kotlin

import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView

class MainActivity : AppCompatActivity() {

    private val fruitList = ArrayList<Fruit>()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        // 初始化水果数据
        initFruits()
        /**
         * 创建一个LinearLayoutManager对象，并将它设置到RecyclerView当中。
         *
         * LayoutManager用于指定RecyclerView的布局方式，这里使用的
         * LinearLayoutManager是线性布局的意思，可以实现和ListView类似的效果。
         */
        val layoutManager = LinearLayoutManager(this)
        val recyclerView: RecyclerView = findViewById(R.id.recyclerView)
        recyclerView.layoutManager = layoutManager
        /**
         * 创建FruitAdapter的实例，并将水果数据传入FruitAdapter的构造函数中，最后调用
         * RecyclerView的setAdapter()方法来完成适配器设置，这样RecyclerView和数据之间的关
         * 联就建立完成了。
         */
        val adapter = FruitAdapter(fruitList)
        recyclerView.adapter = adapter
    }

    private fun initFruits(){
        repeat(2){
            fruitList.add(Fruit("Apple", R.drawable.apple_pic))
            fruitList.add(Fruit("Banana", R.drawable.banana_pic))
            fruitList.add(Fruit("Orange", R.drawable.orange_pic))
            fruitList.add(Fruit("Watermelon", R.drawable.watermelon_pic))
            fruitList.add(Fruit("Pear", R.drawable.pear_pic))
            fruitList.add(Fruit("Grape", R.drawable.grape_pic))
            fruitList.add(Fruit("Pineapple", R.drawable.pineapple_pic))
            fruitList.add(Fruit("Strawberry", R.drawable.strawberry_pic))
            fruitList.add(Fruit("Cherry", R.drawable.cherry_pic))
            fruitList.add(Fruit("Mango", R.drawable.mango_pic))
        }
    }
}
```

